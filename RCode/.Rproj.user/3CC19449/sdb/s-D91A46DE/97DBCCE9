{
    "contents" : "---\ntitle: \"NRG Neurophys Results\"\noutput: html_document\n---\n`r library(knitr)` `r opts_chunk$set(cache=FALSE,echo=FALSE)`\n\n```{r loadlibraries, cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}\n#in this chunk we load the required libraries and import the .csv files containing the data output from our Matlab analyses. \nlibrary(knitr)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(xtable)\n```\n\n```{r loadCSV}\nfilename<-\"~/MATLAB/NeurophysNRG/bestFitLRResort.csv\"\nd <- read.csv(filename, na.strings=\"NaN\")\nr<-read.csv('~/MATLAB/NeurophysNRG/RCode/peakregressions.csv')\ngs<-read.csv('~/MATLAB/NeurophysNRG/fitGSPlm.csv')\nr<-r[,2:12]\np<-read.csv('~/MATLAB/NeurophysNRG/peakAnalysis.csv',na.strings=\"NaN\")\nsource('~/MATLAB/NeurophysNRG/RCode/StatSmoothFunc.R') #function to add formula to regression\n```\n\n```{r Signficance,echo=FALSE}\n#In this chunk, we're doing statistical tests to identify cells with signficant correlations between peak head velocity and peak firing rate (p values stored in p.right and p.left). We are also identifying cells with an effect of trial type (noticing if the slope or intercept is significant for the interaction). \np$isgs<-as.factor(p$isgs)\nlevels(p$isgs)<-c('Pursuit','Gaze Shift')\np$maxsdf<-p$maxsdf*1400 #scale to spikes/s \n\np %>%\n  group_by(Neuron) %>%\n  do(right.model=summary(lm(maxsdf~head_peak,data=filter(.,head_peak>20))),\n     left.model =summary(lm(maxsdf~head_peak,data=filter(.,head_peak< -20)))) %>%\n  mutate(r.right=right.model$r.squared,\n            r.left=left.model$r.squared,\n            slope.right=right.model[[4]][2],\n            slope.left=left.model[[4]][2],\n            intercept.right=right.model[[4]][1],\n            intercept.left=left.model[[4]][1],\n            p.right=right.model[[4]][8],\n            p.left=left.model[[4]][8]) %>%\n  select(-2,-3)->\n  mm\n\npp<-merge(p,mm,by='Neuron')\n\nn.total<-length(unique(pp$Neuron))\n\n```\n\n#Results\nWe isolated 163 neurons (94 from S and 69 from U) in our target region while monkeys performed head-unrestrained gaze shifts and gaze pursuit tasks. This report includes a detailed analysis of 51 of these neurons,  chosen based on apparent task-related activity while the monkey completion of at least 30 trials randomly selected from our two task types.\n\nWe find that the activity of many of these neurons is related to the velocity of the head as it contributes to gaze movement. In figure 1, we show scatter plots comparing the peak head velocity with the peak firing rate of some example cells in our data set. Data from the entire data set appears in Supplementary Figure 1 at the end of this document. Each point represents a single successful trial and both task types are included. It appears that peak firing rate increases linearly with peak head velocity, but often only in a single direction. \n\n```{r exampleCells, fig.width=9,fig.height=11}\n#In this figure, we're showing all the cells with significant regressions for leftward movements\nqplot(head_peak,maxsdf,\n      data=filter(pp,r.left>0.4 | r.right>0.4))+\n  facet_wrap(~Neuron,ncol=3)+\n  theme_bw()+\n  ylab('Peak Firing Rate (spikes/s)')+\n  xlab('Peak Head Velocity (deg/s)')\n```\n\nWe calculate the least squares regression line for this relationship in each direction for all of the neurons shown in Figure 1. We test the significance of this regression line using a t-test against the null hypothesis that the slope is zero, indicating no relationship. With a significance threshold of p<0.001, we find 20 cells with significant regressions for leftward head movements, 20  for rightward, and nine for movements in either direction. Table 1 shows the result of this analysis for the 10 cells with best fits. Results from all cells are included in Supplementary Table 1. We plot the least squares regression lines on the same axes for all of the cells with significant regressions in at least one direction in Figure 2.\n\n```{r regressionTable}\nmm %>%\n  mutate(max.r=max(r.left,r.right)) %>%\n  arrange(desc(max.r))->\n  tpeak\n#convert to numeric columns. do returns a list\n  tpeak[-1]<-sapply(tpeak[-1],unlist)\n  kable(tpeak[1:10,1:length(tpeak)-1],digits=3,align='l')\n```\n\n![Linear regression models for the relationship between peak head velocity and peak firing rate of each neuron.](peakregressions.png)\n\nWe find more evidence of head velocity-related activity in the results of the stepwise linear modeling analysis. For each neuron, we attempted to construct a model to predict the firing rate of the cell. We began with a constant model and programmatically added terms to the model that improved the R^2^ by at least 0.5. Possible terms included the position, velocity and acceleration of the eyes or head in either direction. This gave a total of 12 terms that could potentially be included. We allowed for the inclusion of first-order interactions but none were added to the final models of any cells in our data set. With these criteria, leftward head velocity was a component in the models of 30 neurons and rightward head velocity was included in 29.  Figure 2 shows the frequency with which the 12 potential terms were included in any models. \n\n```{r coefCounts,warning=FALSE,message=FALSE,echo=FALSE}\n\nd %>% \n  select(rhv:lea) %>% \n  mutate_each(funs(!is.na(.))) %>%\n  summarise_each(funs(sum)) %>% \n  gather('c','n',1:12) %>%\n  mutate(c=reorder(c,desc(n))) ->\n  s\n\nqplot(y=n,x=s$c,geom='bar',stat='identity',data=s)+\n  xlab('Variable')+ylab('Count')+\n  theme_bw()+\n  theme(axis.text.x=element_text(size=18,angle=45, hjust=1))\n\n```\n\nFrom the histogram in Figure 2, it is clear that head velocity is the most important factor for predicting the firing rate of the neurons, but other terms are also included for some cells. Neither eye velocity nor acceleration are included in any models, and head acceleration is included in only one. However, there are a number of neurons with a term related to the position of the head or the positions of the eyes in the orbits. Although the best fit for three neurons included only terms related to position, the rest have position terms in addition to head velocity. We show the results of the stepwise regression modeling for the ten cells with the best fit in Table 2. Results from all neurons are shown in Supplementary Table 2.\n\n```{r formulatable}\ntab<-xtable(d[,1:4],caption='This table shows the results of a step-wise fitting procedure that with a threshold for inclusion of an increase of 0.5 in the R2')\n#print(tab,comment=FALSE)\nkable(d[1:10,1:4],digits=2,align='l')\n```\n\nEye and head position are often correlated, so we include an additional analysis to determine what best explains the position-related activity observed in some cells. The design of our gaze shift task required subjects to initially maintain gaze fixation on a centrally located visual target with the eyes and head in one of three horizontal configurations. After the gaze shift, subjects were required to maintain gaze fixation of the second visual target without any further requirement for eye and head position. This enables us to dissociate eye and head position during fixations. Figure 3 shows a neuron with activity related to eye position. In the left panel, notice the activity after the gaze shift while the eyes and head are both to the right. In the right panel, we dissociate eye and head position during the fixation before the gaze shift and observe similar activity while the eyes are to the right in the orbits and the head is pointed leftward, indicating the activity is related to the rightward position of the eyes. This figure also shows the prediction of the model incorporating two terms: rightward head velocity and rightward eye position. \n\n![ModelPositionExample](ModelDemoSB21Oct11.png)\n\nIn order to assess the effect of eye and head position systematically,  we limited trials to only the periods of fixation before and after gaze shifts, then fit a model with four terms, leftward and rightward eye and head position.  This allowed us to determine how much each term contributes to the activity observed during fixation. When interpreting the mathematical models in terms of behaviors contributing to the neural activity, it is more useful to describe the activity as being related to rightward eye position, rather than negatively correlated with leftward eye position or rightward head position. In Table 3, we show the results of this regression, highlighting the term that contributes the most in terms of spikes/s per deg/s.\n\n```{r staticTable,echo=FALSE,fig.width=6}\nstaticBestFitLR <- read.csv(\"~/MATLAB/NeurophysNRG/Resort/staticBestFitLR.csv\", na.strings=\"NaN\")\n\nstaticBestFitLR %>%\n  select(1:7) %>%\n  rename(Rightward.Eye=rep,Leftward.Eye=lep,Rightward.Head=rhp,Leftward.Head=lhp) %>%\n  gather('coef','b',4:6) %>%\n  group_by(Neuron) %>%\n  summarise(Position.Type=coef[b==max(b)],rsquared=max(rsquared),Coefficient=max(b)) %>%\n  arrange(desc(rsquared))-> tstatic\nkable(tstatic,digits=2,align='l')\n```\n\n\n\n\n#Supplementary Figures\n\n```{r peakAnalysisDUMP,fig.width=9, fig.height=10,echo=FALSE}\nneurons<-levels(p$Neuron)\nn.neurons<-length(neurons)\np1<-subset(p,Neuron %in% neurons[1:18])\np2<-subset(p,Neuron %in% neurons[19:36])\np3<-subset(p,Neuron %in% neurons[37:n.neurons])\n#p4<-subset(p,Neuron %in% neurons[46:n.neurons])\nqplot(head_peak,maxsdf*1400,data=p1)+\n  facet_wrap(~Neuron,ncol=3)+\n  ylab('Peak Firing Rate (spikes/s)')+\n  xlab('Peak Head Velocity (deg/s)')\nqplot(head_peak,maxsdf*1400,data=p2)+\n  facet_wrap(~Neuron,ncol=3)+\n  ylab('Peak Firing Rate (spikes/s)')+\n  xlab('Peak Head Velocity (deg/s)')\nqplot(head_peak,maxsdf*1400,data=p3)+\n  facet_wrap(~Neuron,ncol=3)+\n  ylab('Peak Firing Rate (spikes/s)')+\n  xlab('Peak Head Velocity (deg/s)')\n#qplot(head_peak,maxsdf*1400,data=p4)+\n#  facet_wrap(~Neuron,ncol=3)+\n#  ylab('Peak Firing Rate (spikes/s)')+\n#  xlab('Peak Head Velocity (deg/s)')\n  \n```\n\n```{r fullRegressTable}\nkable(tpeak[,1:length(t)-1],digits=3,align='l')\n```\n\n```{r fullformulatable}\ntab<-xtable(d[,1:4],caption='This table shows the results of a step-wise fitting procedure that with a threshold for inclusion of an increase of 0.5 in the R2')\n#print(tab,comment=FALSE)\nkable(d[,1:4],digits=2,align='l')\n```",
    "created" : 1427913672894.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1184760678",
    "id" : "97DBCCE9",
    "lastKnownWriteTime" : 1428179937,
    "path" : "~/MATLAB/NeurophysNRG/RCode/Results.Rmd",
    "project_path" : "Results.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}